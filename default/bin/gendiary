#!/bin/bash
# Generate a diary for the given year.

year=$1
dailies=$2

days() {
    local start=$1
    local end=$2
    local date=$start
    local week=$(date -d"$date" +"%W")
    local lastweek=
    while [[ "$date" != "$end" ]]; do
        local name=$(date -d"$date" +"%a")
        if [[ "$name" != "Sat" && "$name" != "Sun" ]]; then
            week=$(date -d"$date" +"%W")
            if [[ "$week" != "$lastweek" ]]; then
                echo "==== Week $week ===="
                lastweek=$week
            fi
            echo $(date -d"$date" +"===== %a %Y-%m-%d =====")
            local fname="$dailies/$date.wiki"
            if [[ -f "$fname" ]]; then
                cat "$fname"
                echo
            fi
        fi
        date=$(date -I -d"$date +1day")
    done
}

month() {
    local start=$(date -I -d"$1")
    local end=$(date -I -d"$start +1month")
    days $start $end
}

quarter() {
    local date=$1
    for month in $(seq 1 3); do
        echo "=== "$(date -d"$date" +"%B")" ==="
        month $date
        date=$(date -I -d"$date +1month")
    done
}

echo "== Quarter 1 =="
quarter $year-03-01
echo "== Quarter 2 =="
quarter $year-06-01
echo "== Quarter 3 =="
quarter $year-09-01
echo "== Quarter 4 =="
quarter $year-12-01
