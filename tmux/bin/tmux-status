#!/bin/bash

CMD=$1
shift
case $CMD in
    icon)
        name="$1"
        case "$name" in
            code)   echo " " ;;
            git)    echo "󰘬 " ;;
            build)  echo " " ;;
            debug)  echo " " ;;
            bash)   echo " " ;;
            slack)  echo "󰒱 " ;;
            mutt)   echo "󰇰 " ;;
            todo)   echo " " ;;
            *)      echo "" ;;
        esac
    ;;
    branch)
        cd "$1"
        git rev-parse --is-inside-work-tree || exit 0
        echo "󰘬 $(git rev-parse --abbrev-ref HEAD)  "
    ;;
    toolbox)
        name=$(echo "$1" | sed 's/\//-/')
        podman container exists $name || exit 0
        if [ "$2" == "toolbox" ]; then
            color='#d3869b'
        else
            color='#928374'
        fi
        pfx=".Config.Labels"
        key="#[fg=${color}]󰆧 {{${pfx}.name}}-{{${pfx}.version}}#[default]  "
        podman inspect --format "$key" "$name"
    ;;
    test)
        name=".testsuite.log"
        cd "$1"
        [ -e "$name" ] || exit 0
        if grep -qe '\(was\|were\) successful\.' "$name"; then
            echo "#[fg=#98971a]#[default]  "
        elif grep -q 'failed' "$name"; then
            echo "#[fg=#cc241d]#[default]  "
        else
            echo "#[fg=#d79921]#[default]  "
        fi
    ;;
esac
